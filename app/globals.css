@tailwind base;
@tailwind components;
@tailwind utilities;

@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=JetBrains+Mono:wght@400&display=swap');

/* === SKIN DEFINITIONS === */

/* 1. Alfred: Charcoal/Silver */
:root[data-skin="alfred"] {
  --bg-color: #1e1e1e;
  --text-color: #e5e5e5;
  --accent-color: #60a5fa;
  --panel-color: rgba(40, 40, 40, 0.95);
  --border-color: #404040;
  --input-bg: #262626;
  --highlight-color: #3f3f46;
  --font-family: 'Inter', sans-serif;
  --indicator-color: #60a5fa;
  --caret-color: #e5e5e5;
  --input-text-color: #e5e5e5;
}

/* 2. Neo: Terminal */
:root[data-skin="neo"] {
  --bg-color: #000000;
  --text-color: #22c55e;
  --accent-color: #4ade80;
  --panel-color: rgba(10, 10, 10, 0.9);
  --border-color: #14532d;
  --input-bg: #22c55e;
  --input-text-color: #000000;
  --highlight-color: #1a1a1a;
  --font-family: 'JetBrains Mono', 'Courier New', monospace;
  --indicator-color: #22c55e;
  --caret-color: #000000;
  --glow: 0 0 10px rgba(34, 197, 94, 0.4);
}

/* 3. MsTramell: Obsidian/Gold */
:root[data-skin="mstramell"] {
  --bg-color: #1a1918;
  --text-color: #dcd0b3;
  --accent-color: #c5b358;
  --panel-color: rgba(35, 32, 32, 0.9);
  --border-color: #4a0404;
  --input-bg: #1f1d1d;
  --highlight-color: #3e2752;
  --font-family: 'Playfair Display', serif;
  --indicator-color: #c5b358;
  --caret-color: #c5b358;
  --input-text-color: #dcd0b3;
}

body {
  background-color: var(--bg-color);
  color: var(--text-color);
  font-family: var(--font-family);
  transition: background-color 0.5s ease, color 0.5s ease;
}

/* Sticky Layout */
.sticky-header {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  z-index: 50;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 1.5rem;
  pointer-events: none;
}

.skin-slider {
  pointer-events: auto;
}

.avatar-stage {
  margin-top: 1.5rem;
  transition: all 0.5s ease;
  pointer-events: auto;
}

.chat-viewport {
  position: relative;
  /* Padding moved to internal sections for scrolling */
  /* padding-top: 180px; */
  /* padding-bottom: 8rem; */
  overflow-y: auto;
  scroll-behavior: auto;
  /* Removed smooth to prevent scroll locking */
}

/* Smooth Fade Transition Logic */
.chat-section {
  display: flex !important;
  /* Always flex, control visibility with opacity/z-index */
  flex-direction: column;
  position: absolute;
  /* Absolute to allow overlap */
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  opacity: 0;
  z-index: 0;
  pointer-events: none;
  /* Prevent clicks when hidden */
  transition: opacity 0.5s ease-in-out;
  /* Smooth fade */
}

.chat-section.active {
  opacity: 1;
  z-index: 10;
  pointer-events: auto;
  /* Enable clicks when active */
  position: relative;
  /* Relative when active to take up space? No, keep absolute to prevent height jumps, or use container height */
  /* Actually, for scrolling to work, the active one needs to be relative OR the container needs to handle scrolling. 
     Given the structure, absolute is safer for transition, but scrolling might be tricky. 
     Let's try absolute inset-0 */
}

/* 
   CRITICAL: content needs to scroll. 
   If sections are absolute, the parent (.chat-viewport) determines the scroll area.
   But if section is absolute height 100%, it might clip.
   Let's ensure .chat-section takes full height and scrolls internally if needed, OR parent scrolls.
   The parent .chat-viewport has overflow-y: auto.
   If .chat-section is absolute, it might not expand the parent.
   
   Better Approach for "Safe" Transition:
   - Use Grid stack (all items in same grid cell)
*/

.chat-viewport {
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: 1fr;
  /* padding is already set */
}

.chat-section {
  grid-column: 1;
  grid-row: 1;
  display: flex;
  flex-direction: column;
  opacity: 0;
  z-index: 0;
  pointer-events: none;
  transition: opacity 0.5s ease-in-out;
  overflow-y: auto;
  /* Internal scrolling */
  height: 100%;
  width: 100%;
  padding-bottom: 8rem;
  /* Space for input */
  padding-top: 180px;
  /* Space for header */
}

/* Actually, the viewport is the scroller in original design. 
   If we use grid stack, the viewport height is fixed (flex-1). 
   So the chat-section itself should scroll or be scrollable.
   Original: .chat-viewport { overflow-y: auto }
   
   If we stack them, they need to be inside the scrollable area. 
   But if they fade, they must overlap.
   
   Let's stick to the Absolute approach but ensures scroll works.
*/
/* SMOOTH TRANSITION (Grid Stack Method) */
.chat-viewport {
  display: grid !important;
  grid-template-columns: 1fr;
  grid-template-rows: 1fr;
  overflow: hidden !important;
}

/* Base Chat Section (Stacked) */
.chat-section {
  grid-column: 1 / 1;
  grid-row: 1 / 1;
  width: 100%;
  height: 100%;
  overflow-y: auto;
  opacity: 0;
  transition: opacity 0.5s ease-in-out;
  display: flex;
  flex-direction: column;
  padding-bottom: 8rem;
  /* Space for Input Bar */
  z-index: 1;
  pointer-events: none;
  /* Passes clicks through when invisible */
}

/* Active State */
.chat-section.active {
  opacity: 1;
  z-index: 10;
  pointer-events: auto;
  /* Catch clicks only when active */
}


/* Generated Image Styling */
.chat-image {
  max-width: 100%;
  border-radius: 12px;
  margin-top: 10px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
  display: block;
  transition: transform 0.3s ease;
}

.chat-image:hover {
  transform: scale(1.02);
}

/* Neo Specific Image Style */
.chat-section.neo .chat-image {
  border: 2px solid #00ff41;
  box-shadow: 0 0 10px #00ff41;
}

/* MsTramell Specific Image Style */
.chat-section.mstramell .chat-image {
  border: 2px solid #d4af37;
  box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
}


.avatar-view {
  display: none;
  opacity: 0;
  transform: scale(0.9);
  transition: all 0.5s ease;
}

.avatar-view.active {
  display: flex;
  opacity: 1;
  transform: scale(1);
}

@keyframes fadeUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Neo Glow */
:root[data-skin="neo"] .neo-text {
  text-shadow: var(--glow);
}

.neo-cursor {
  display: inline-block;
  width: 10px;
  height: 1.2em;
  background-color: var(--accent-color);
  animation: blink 1s step-end infinite;
  vertical-align: text-bottom;
}

@keyframes blink {
  50% {
    opacity: 0;
  }
}

/* Alfred/Tramell Icons */
.rounded-avatar {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 50%;
}

.alfred-border {
  border: 2px solid #404040;
}

.mstramell-border {
  border: 2px solid #c5b358;
  opacity: 0.9;
}

/* Glass Panel */
.glass-panel {
  background-color: var(--panel-color);
  backdrop-filter: blur(12px);
  border: 1px solid var(--border-color);
}

/* === MOBILE OPTIMIZATION === */
@media (max-width: 768px) {

  /* CRITICAL: Prevent horizontal overflow */
  body,
  html,
  main {
    overflow-x: hidden !important;
    max-width: 100vw !important;
  }

  /* Hide Sidebar on mobile to save space */
  /* DISABLED to allow hamburger menu drawer to work */
  /* aside {
    display: none !important;
  } */

  /* Adjust Chat Viewport padding */
  .chat-viewport {
    padding-top: 120px;
    /* Reduced from 180px */
    padding-bottom: 6rem;
    /* Reduced bottom padding */
    padding-left: 1rem;
    padding-right: 1rem;
  }

  /* Adjust Sticky Header / Avatar Stage */
  .sticky-header {
    padding-top: 0.5rem;
  }

  .avatar-stage {
    margin-top: 0.5rem;
    transform: scale(0.8);
    /* Shrink avatars slightly */
  }

  /* Adjust Input Bar positioning */
  .absolute.bottom-10 {
    bottom: 1rem !important;
  }

  /* Constrain Input Container Width */
  .absolute.bottom-10>div {
    max-width: 100% !important;
  }

  /* Shrink glass panel input padding on mobile */
  .glass-panel input {
    padding-left: 0.75rem !important;
    padding-right: 0.75rem !important;
  }

  /* Make message bubbles wider on mobile */
  /* Input Controls: Don't hide, but shrink gap */
  .input-left-controls {
    display: flex !important;
    /* Restore controls */
    gap: 0.25rem !important;
    transform: scale(0.9);
    /* Slight shrink */
  }

  /* Chat Bubbles: Use more width */
  .chat-section .max-w-\[80\%\] {
    max-width: 92% !important;
  }

  /* Word wrap for message bubbles */
  .chat-section>div>div>div>div {
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  /* Heading Text scaling */
  .chat-section h1 {
    font-size: clamp(1.75rem, 6vw, 2.25rem) !important;
  }

  /* Further constrain input on very narrow screens */
  @media (max-width: 400px) {
    .absolute.bottom-10 {
      left: 0.25rem !important;
      right: 0.25rem !important;
      padding-left: 0.25rem !important;
      padding-right: 0.25rem !important;
    }

    .glass-panel {
      padding: 0.5rem !important;
    }
  }
}

#user-input {
  color: var(--input-text-color);
}

#user-input::placeholder {
  color: var(--input-text-color);
  opacity: 0.5;
}